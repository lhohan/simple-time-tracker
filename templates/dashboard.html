{% extends "base.html" %}

{% block content %}
<h1>Time Tracker Dashboard</h1>

<div id="summary">
    <h2>Total Time Tracked: <strong>{{ total_time }}</strong></h2>
</div>

<div id="filters">
    <h3>Filter by Period</h3>
    <button hx-get="/api/dashboard?period=today" hx-target="#projects"
            onclick="updateCharts('today')">Today</button>
    <button hx-get="/api/dashboard?period=this-week" hx-target="#projects"
            onclick="updateCharts('this-week')">This Week</button>
    <button hx-get="/api/dashboard?period=this-month" hx-target="#projects"
            onclick="updateCharts('this-month')">This Month</button>
    <button hx-get="/api/dashboard" hx-target="#projects"
            onclick="updateCharts('')">All Time</button>
</div>

<div class="grid">
    <div id="chart-bar" hx-get="/api/chart/projects-bar" hx-trigger="load" hx-swap="innerHTML">
        <p>Loading bar chart...</p>
    </div>
    <div id="chart-pie" hx-get="/api/chart/projects-pie" hx-trigger="load" hx-swap="innerHTML">
        <p>Loading pie chart...</p>
    </div>
</div>

<script>
function updateCharts(period) {
    const barUrl = period ? `/api/chart/projects-bar?period=${period}` : '/api/chart/projects-bar';
    const pieUrl = period ? `/api/chart/projects-pie?period=${period}` : '/api/chart/projects-pie';
    htmx.ajax('GET', barUrl, {target:'#chart-bar', swap:'innerHTML'});
    htmx.ajax('GET', pieUrl, {target:'#chart-pie', swap:'innerHTML'});
}
</script>

<div id="projects">
    {% if projects.len() > 0 %}
    <h2>Time by Project</h2>
    <table>
        <thead>
            <tr>
                <th>Project</th>
                <th>Duration</th>
                <th>Percentage</th>
            </tr>
        </thead>
        <tbody>
            {% for project in projects %}
            <tr>
                <td>
                    <a href="#" hx-get="/api/tag/{{ project.description }}" hx-target="#detail">
                        {{ project.description }}
                    </a>
                </td>
                <td>{{ project.minutes }} min</td>
                <td>{{ project.percentage }}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>

<div id="detail"></div>
{% endblock %}
